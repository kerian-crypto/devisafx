<!-- Template pour le modal des détails de transaction (admin) -->
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Référence</h6>
            <p class="mb-0"><code>{{ transaction.identifiant_transaction }}</code></p>
        </div>
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Date de création</h6>
            <p class="mb-0">{{ transaction.date_creation.strftime('%d/%m/%Y à %H:%M') }}</p>
        </div>
    </div>
    
    <hr>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Utilisateur</h6>
            <p class="mb-0"><strong>{{ transaction.utilisateur.nom }}</strong></p>
            <p class="mb-0"><small>{{ transaction.utilisateur.email }}</small></p>
            <p class="mb-0"><small>{{ transaction.utilisateur.telephone }}</small></p>
        </div>
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Type de transaction</h6>
            <p class="mb-0">
                {% if transaction.type_transaction == 'achat' %}
                <span class="badge bg-primary">Achat de USDT</span>
                {% else %}
                <span class="badge bg-success">Vente de USDT</span>
                {% endif %}
            </p>
        </div>
    </div>
    
    <hr>
    
    <div class="row mb-3">
        <div class="col-md-4">
            <h6 class="text-muted mb-1">Montant XAF</h6>
            <p class="mb-0"><strong>{{ formater_montant(transaction.montant_xaf) }} XAF</strong></p>
        </div>
        <div class="col-md-4">
            <h6 class="text-muted mb-1">Montant USDT</h6>
            <p class="mb-0"><strong>{{ transaction.montant_usdt }} USDT</strong></p>
        </div>
        <div class="col-md-4">
            <h6 class="text-muted mb-1">Taux appliqué</h6>
            <p class="mb-0">{{ transaction.taux_applique|round(2) }} XAF/USDT</p>
        </div>
    </div>
    
    <hr>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Réseau</h6>
            <p class="mb-0"><span class="badge bg-info">{{ transaction.reseau }}</span></p>
        </div>
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Opérateur mobile</h6>
            <p class="mb-0">{{ transaction.operateur_mobile }}</p>
        </div>
    </div>
    
    {% if transaction.type_transaction == 'achat' %}
    <hr>
    <div class="alert alert-light">
        <h6 class="mb-2"><i class="fas fa-wallet me-2"></i>Adresse wallet du client</h6>
        <div class="d-flex align-items-center">
            <code class="flex-grow-1">{{ transaction.adresse_wallet }}</code>
            <button class="btn btn-sm btn-outline-primary ms-2" 
                    onclick="copyToClipboard('{{ transaction.adresse_wallet }}', this)"
                    title="Copier l'adresse">
                <i class="fas fa-copy"></i>
            </button>
        </div>
    </div>
    
    {% if info_admin %}
    <div class="alert alert-warning">
        <h6 class="mb-2"><i class="fas fa-mobile-alt me-2"></i>{{ info_admin.label }}</h6>
        <div class="d-flex align-items-center">
            <strong class="flex-grow-1">{{ info_admin.value }}</strong>
            <button class="btn btn-sm btn-outline-dark ms-2" 
                    onclick="copyToClipboard('{{ info_admin.value }}', this)"
                    title="Copier">
                <i class="fas fa-copy"></i>
            </button>
        </div>
        <small class="text-muted d-block mt-2">
            <i class="fas fa-info-circle me-1"></i>
            Le client doit effectuer le paiement à ce numéro
        </small>
    </div>
    {% endif %}
    
    {% elif transaction.type_transaction == 'vente' %}
    
    {% if info_admin %}
    <hr>
    <div class="alert alert-success">
        <h6 class="mb-2"><i class="fas fa-link me-2"></i>{{ info_admin.label }}</h6>
        <div class="d-flex align-items-center">
            <code class="flex-grow-1" style="word-break: break-all; font-size: 0.85rem;">{{ info_admin.value }}</code>
            <button class="btn btn-sm btn-outline-dark ms-2" 
                    onclick="copyToClipboard('{{ info_admin.value }}', this)"
                    title="Copier l'adresse">
                <i class="fas fa-copy"></i>
            </button>
        </div>
        <small class="text-muted d-block mt-2">
            <i class="fas fa-info-circle me-1"></i>
            Le client doit envoyer les USDT à cette adresse sur le réseau {{ transaction.reseau }}
        </small>
    </div>
    {% endif %}
    {% endif %}
    
    {% if transaction.numero_marchand %}
    <hr>
    <div class="mb-3">
        <h6 class="text-muted mb-1">Numéro marchand</h6>
        <p class="mb-0">{{ transaction.numero_marchand }}</p>
    </div>
    {% endif %}
    
    {% if transaction.reference_paiement %}
    <hr>
    <div class="mb-3">
        <h6 class="text-muted mb-1">Référence de paiement</h6>
        <p class="mb-0">{{ transaction.reference_paiement }}</p>
    </div>
    {% endif %}
    
    {% if transaction.preuve_paiement %}
    <hr>
    <div class="mb-3">
        <h6 class="text-muted mb-1">Preuve de paiement</h6>
        <img src="{{ url_for('static', filename='uploads/' + transaction.preuve_paiement) }}" 
             class="img-fluid rounded" 
             style="max-height: 300px;"
             alt="Preuve de paiement">
    </div>
    {% endif %}
    
    <hr>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Statut</h6>
            <p class="mb-0">
                <span class="status-badge status-{{ transaction.statut }}">
                    {{ transaction.statut.replace('_', ' ') }}
                </span>
            </p>
        </div>
        {% if transaction.date_validation %}
        <div class="col-md-6">
            <h6 class="text-muted mb-1">Date de validation</h6>
            <p class="mb-0">{{ transaction.date_validation.strftime('%d/%m/%Y à %H:%M') }}</p>
        </div>
        {% endif %}
    </div>
    
    {% if transaction.motif_rejet %}
    <div class="alert alert-danger">
        <h6 class="mb-2"><i class="fas fa-exclamation-triangle me-2"></i>Motif de rejet</h6>
        <p class="mb-0">{{ transaction.motif_rejet }}</p>
    </div>
    {% endif %}
</div>

<script>
// Fonction de copie (si pas déjà définie)
if (typeof copyToClipboard !== 'function') {
    function copyToClipboard(text, button) {
        navigator.clipboard.writeText(text).then(() => {
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.classList.add('btn-success');
            button.classList.remove('btn-outline-primary', 'btn-outline-dark');
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-primary');
            }, 2000);
        }).catch(err => {
            alert('Erreur lors de la copie : ' + err);
        });
    }
}
</script>
